<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Decentralised Creative Network API</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Syne:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <link href="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.css" rel="stylesheet" type="text/css" />

    <script type="module">
        import {
            fetchBeforeExecute,
            saveInstanceEdit,
            closePopup,
            execute
        } from '/js/execute';

        import {
            loginWithMetaMask,
            fetchVersionInfo,

            updateFeatureRequestPreview,
            addDimension,
            clearDimensions,
            sendStructuredFeature,
            getFeature,

            updateTransformationPreview,
            sendStructuredTransformation,
            getTransformation,

            updateConditionPreview,
            sendStructuredCondition,
            getCondition,

            updateParticlePreview,
            fetchParticleFeatureDimensions,
            sendStructuredParticle,
            getParticle,

            fetchAccountResources,
            nextPage,
            prevPage,

            copyTextFromElement
        } from '/js/simple_form';

        fetchVersionInfo();

        document.getElementById('login').addEventListener('click', loginWithMetaMask);

        document.getElementById('btn_fetchBeforeExecute').addEventListener('click', fetchBeforeExecute);
        document.getElementById('btn_saveInstanceEdit').addEventListener('click', saveInstanceEdit);
        document.getElementById('btn_closePopup').addEventListener('click', closePopup);
        document.getElementById('btn_execute').addEventListener('click', execute);
        document.getElementById('btn_executeCopyResponse').addEventListener('click', () => copyTextFromElement('executeBody'));

        document.getElementById('in_featureName').addEventListener('input', updateFeatureRequestPreview);
        document.getElementById('btn_addDimension').addEventListener('click', addDimension);
        document.getElementById('btn_clearDimensions').addEventListener('click', clearDimensions);
        document.getElementById('btn_sendStructuredFeature').addEventListener('click', sendStructuredFeature);
        document.getElementById('btn_getFeature').addEventListener('click', getFeature);
        document.getElementById('btn_featureCopyRequest').addEventListener('click', () => copyTextFromElement('POST_featureRequestBody'));

        document.getElementById('in_transformationName').addEventListener('input', updateTransformationPreview);
        document.getElementById('POST_transformationCode').addEventListener('input', updateTransformationPreview);
        document.getElementById('btn_sendStructuredTransformation').addEventListener('click', sendStructuredTransformation);
        document.getElementById('btn_getTransformation').addEventListener('click', getTransformation);
        document.getElementById('btn_transformationCopyRequest').addEventListener('click', () => copyTextFromElement('POST_transformationRequestBody'));

        document.getElementById('in_conditionName').addEventListener('input', updateConditionPreview);
        document.getElementById('POST_conditionCode').addEventListener('input', updateConditionPreview);
        document.getElementById('btn_sendStructuredCondition').addEventListener('click', sendStructuredCondition);
        document.getElementById('btn_getCondition').addEventListener('click', getCondition);
        document.getElementById('btn_conditionCopyRequest').addEventListener('click', () => copyTextFromElement('POST_conditionRequestBody'));

        document.getElementById('in_particleName').addEventListener('input', updateParticlePreview);
        document.getElementById('in_particleFeatureName').addEventListener('input', updateParticlePreview);
        document.getElementById('btn_particleLoadFeature').addEventListener('click', fetchParticleFeatureDimensions);
        document.getElementById('particleCompositesContainer').addEventListener('input', updateParticlePreview);
        document.getElementById('in_particleConditionName').addEventListener('input', updateParticlePreview);
        document.getElementById('in_particleConditionArgs').addEventListener('input', updateParticlePreview);
        document.getElementById('btn_sendStructuredParticle').addEventListener('click', sendStructuredParticle);
        document.getElementById('btn_getParticle').addEventListener('click', getParticle);
        document.getElementById('btn_particleCopyRequest').addEventListener('click', () => copyTextFromElement('POST_particleRequestBody'));

        document.getElementById('btn_fetchAccountData').addEventListener('click', fetchAccountResources);
        document.getElementById('btn_prevAccountPage').addEventListener('click', prevPage);
        document.getElementById('btn_nextAccountPage').addEventListener('click', nextPage);

        const nav = document.getElementById('siteNav');
        const navToggle = document.getElementById('siteNavToggle');
        if (nav && navToggle) {
            navToggle.addEventListener('click', () => {
                const open = nav.classList.toggle('is-open');
                navToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
            });

            nav.querySelectorAll('.site-links a').forEach((anchor) => {
                anchor.addEventListener('click', () => {
                    nav.classList.remove('is-open');
                    navToggle.setAttribute('aria-expanded', 'false');
                });
            });

            window.addEventListener('resize', () => {
                if (window.innerWidth > 900) {
                    nav.classList.remove('is-open');
                    navToggle.setAttribute('aria-expanded', 'false');
                }
            });
        }

    </script>
    <link rel="stylesheet" href="styles/simple_form.css">

</head>

<body>
    <header class="site-nav" id="siteNav">
        <div class="site-nav-inner">
            <a href="https://decentralised.art/" class="site-brand">Decentralised Creative Network</a>
            <button
                type="button"
                class="site-nav-toggle"
                id="siteNavToggle"
                aria-expanded="false"
                aria-label="Toggle navigation menu"
            >
                <span class="site-nav-toggle-open">‚ò∞</span>
                <span class="site-nav-toggle-close">‚úï</span>
            </button>
            <nav class="site-links" aria-label="Primary">
                <a href="https://decentralised.art/">Home</a>
                <a href="https://decentralised.art/onboarding">Tutorial</a>
                <a href="https://decentralised.art/api-tutorial">Documentation</a>
                <a href="https://decentralised.art/examples">Examples</a>
                <a href="/" class="site-link-open-api">Open API</a>
            </nav>
        </div>
    </header>

    <main class="api-shell">
    <div style="margin-top: 1rem; color: #888; font-size: 0.9rem; text-align: center;">
        <div id="versionInfo">Loading version info...</div>
    </div>
    <h1>Decentralised Creative Network API</h1>
    <p style="text-align:center; max-width:600px">Interact with the API endpoints directly from your browser.</p>

    <hr>
    <div class="row">
        <div class="column">
            <h2>MetaMask login</h2>

            <div class="response-row" style="display: flex; gap: 1rem; align-items: flex-end;">
                <button id="login" style="min-width: 200px;">Login</button>
                
                <div style="flex: 1; min-width: 120px; margin-right: 1rem;">
                    <label>Status</label>
                    <div id="loginStatus" class="response-body">Waiting...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
      <div class="column">
        <h2>Account Overview</h2>
        <div class="response-row" style="display: flex; gap: 1rem; align-items: flex-end;">
            <button id="btn_fetchAccountData" style="min-width: 200px;">Fetch Account Data</button>
            
            <div style="flex: 1; min-width: 120px; margin-right: 1rem;">
                <label>Address</label>
                <input type="text" id="accountAddressInput" class="response-body" placeholder="0x..." style="flex: 3;">
            </div>
        </div>
        <div class="account-grid">
            <div class="column">
                <h3>Owned Particles</h3>
                <div id="accountParticlesList" class="response-body">Waiting...</div>
            </div>
            <div class="column">
                <h3>Owned Features</h3>
                <div id="accountFeaturesList" class="response-body">Waiting...</div>
            </div>
            <div class="column">
                <h3>Owned Transformations</h3>
                <div id="accountTransformationsList" class="response-body">Waiting...</div>
            </div>
            <div class="column">
                <h3>Owned Conditions</h3>
                <div id="accountConditionsList" class="response-body">Waiting...</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 1rem;">
            <button id="btn_prevAccountPage">‚¨Ö Prev</button>
            <span id="accountPageLabel" style="margin: 0 1rem;">Page 1</span>
            <button id="btn_nextAccountPage">Next ‚û°</button>
        </div>
      </div>
    </div>


    <hr>

    <div class="row">
        <div class="column">
            <h2>Execute</h2>
            <div class="row" style="display: flex; gap: 1rem; align-items: flex-end;">
                <div style="flex: 1; min-width: 120px; margin-right: 1rem;">
                    <label>Particle name</label>
                    <input id="executeName" type="text" placeholder="pitch">
                </div>
                <div style="flex: 1; min-width: 120px;">
                    <label style="visibility:hidden;">Fetch</label>
                    <button id = "btn_fetchBeforeExecute">Fetch</button>
                </div>
            </div>
            <div id="popupInstanceEditor" style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%); background:#222; color:#fff; padding:1rem; border-radius:8px; z-index:9999;">
                <h3>Edit Running Instance</h3>
                <p id="popupRunningInstanceLabel"></p>
                <label>Start Point</label>
                <input type="number" id="popupStartPoint" style="width:100%;">
                <label>Transform Shift</label>
                <input type="number" id="popupTransformShift" style="width:100%;">
                <div style="margin-top:1rem; display:flex; justify-content: space-between;">
                    <button id="btn_saveInstanceEdit">Save</button>
                    <button id="btn_closePopup">Cancel</button>
                </div>
            </div>
            <label>Running Instances</label>
            <div class="request-row">
                <div id="executeRunningInstances" class="request-body"></div>
            </div>
            <div class="request-row">
                <div id="treeContainer" style="display: none; width: 100%; height: 400px; background: #1e1e1e; border-radius: 6px; margin: 1rem;"></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="column">
            <div class="row" style="display: flex; gap: 1rem; align-items: flex-end;">
                <div style="flex: 1; min-width: 120px; margin-right: 1rem;">
                    <label>Sample count</label>
                    <input id="executeN" type="number" placeholder="5">
                </div>
                <div style="flex: 1; min-width: 120px;">
                    <label style="visibility:hidden;">Execute</label>
                    <button id="btn_execute">üîí Execute</button>
                </div>
            </div>
            <div class="response-row">
                <div id="executeCode" class="response-code">-</div>
                <div class="response-wrapper">
                    <button id="btn_executeCopyResponse" class="copy-button">üìã</button>
                    <pre id="executeBody" class="response-body">Waiting...</pre>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <div class="row">
        <h2>Features</h2>
        <div style="flex: 1; min-width: 120px; margin-right: 1rem;">
            <label>Name</label>
            <input type="text" id="in_featureName" placeholder="melody">
        </div>
        <div class="row">
        <div class="column">
            <label>Dimensions</label>
            <div id="dimensionsContainer"></div>

            <div class="button-row">
                <button id="btn_addDimension">‚ûï Add dimension</button>
                <button id="btn_clearDimensions">üóëÔ∏è Clear dimensions</button>
            </div>

            <label>Request body</label>
            <div class="request-row">
                <div class="response-wrapper">
                    <button id="btn_featureCopyRequest" class="copy-button">üìã</button>
                    <pre id="POST_featureRequestBody" class="request-body">...</pre>
                </div>
            </div>
            <button id="btn_sendStructuredFeature">üîí Send</button>

            <div class="response-row">
                <div id="POST_featureResponseCode" class="response-code">-</div>
                <div id="POST_featureResponseBody" class="response-body">Waiting...</div>
            </div>
        </div>
        <div class="column">
            <label>Address (optional)</label>
            <input id="GET_featureAddress" type="text" placeholder="0x0...">
            <button id="btn_getFeature">Fetch</button>
            <div class="response-row">
                <div id="GET_featureResponseCode" class="response-code">-</div>
                <div id="GET_featureResponseBody" class="response-body">Waiting...</div>
            </div>
        </div>
    </div>
    </div>

    <hr>

    <div class="row">
        <h2>Transformations</h2>
        <div style="flex: 1; min-width: 120px; margin-right: 1rem;">
            <label>Name</label>
            <input type="text" id="in_transformationName" placeholder="add">
        </div>
        <div class="row">
        <div class="column">
            <div class="column">
                <label>Solidity Code</label>
                <div class="request-body">function run(uint32 x, uint32 [] calldata args) view external returns (uint32){</div>
                <textarea id="POST_transformationCode" placeholder="return x + args[0];"></textarea>
                <div class="request-body">}</div>
            </div>

            <label style="margin:1rem;" >Request body</label>
            <div class="request-row">
                <div class="response-wrapper">
                    <button id="btn_transformationCopyRequest" class="copy-button">üìã</button>
                    <pre id="POST_transformationRequestBody" class="request-body">...</pre>
                </div>
            </div>
            
            <button id="btn_sendStructuredTransformation">üîí Send</button>
            
            <div class="response-row">
                <div id="POST_transformationResponseCode" class="response-code">-</div>
                <div id="POST_transformationResponseBody" class="response-body">Waiting...</div>
            </div>
        </div>
        <div class="column">
            <label>Address (optional)</label>
            <input id="GET_transformationAddress" type="text" placeholder="0x0...">
            <button id="btn_getTransformation">Fetch</button>
            <div class="response-row">
                <div id="GET_transformationResponseCode" class="response-code">-</div>
                <div id="GET_transformationResponseBody" class="response-body">Waiting...</div>
            </div>
        </div>
        </div>
    </div>

    <hr>

    <div class="row">
        <h2>Conditions</h2>
        <div style="flex: 1; min-width: 120px; margin-right: 1rem;">
            <label>Name</label>
            <input type="text" id="in_conditionName" placeholder="add">
        </div>
        <div class="row">
        <div class="column">
            <div class="column">
                <label>Solidity Code</label>
                <div class="request-body">function check(int32 [] calldata args) view external returns (bool){</div>
                <textarea id="POST_conditionCode" placeholder="return args[0] == 1;"></textarea>
                <div class="request-body">}</div>
            </div>

            <label style="margin:1rem;" >Request body</label>
            <div class="request-row">
                <div class="response-wrapper">
                    <button id="btn_conditionCopyRequest" class="copy-button">üìã</button>
                    <pre id="POST_conditionRequestBody" class="request-body">...</pre>
                </div>
            </div>
            
            <button id="btn_sendStructuredCondition">üîí Send</button>
            
            <div class="response-row">
                <div id="POST_conditionResponseCode" class="response-code">-</div>
                <div id="POST_conditionResponseBody" class="response-body">Waiting...</div>
            </div>
        </div>
        <div class="column">
            <label>Address (optional)</label>
            <input id="GET_conditionAddress" type="text" placeholder="0x0...">
            <button id="btn_getCondition">Fetch</button>
            <div class="response-row">
                <div id="GET_conditionResponseCode" class="response-code">-</div>
                <div id="GET_conditionResponseBody" class="response-body">Waiting...</div>
            </div>
        </div>
        </div>
    </div>

    <hr>

    <div class="row">
        <h2>Particles</h2>
        <div style="flex: 1; min-width: 120px; margin-right: 1rem;">
            <label>Name</label>
            <input type="text" id="in_particleName" placeholder="melody-particle">
        </div>
        <div class="row">
        <div class="column">
            <label>Feature name</label>
            <input id="in_particleFeatureName" type="text" placeholder="melody">

            <div class="row" style="display: flex; gap: 1rem; align-items: flex-end;">
                <div style="flex: 1; min-width: 120px;">
                    <label style="visibility:hidden;">Fetch</label>
                    <button id="btn_particleLoadFeature" type="button">Fetch feature dimensions</button>
                </div>
                <div id="particleFeatureInfo" style="flex: 2; color: #888; font-size: 0.9rem;">Fetch the feature to load composite inputs.</div>
            </div>

            <label>Composite names (per dimension)</label>
            <div id="particleCompositesContainer"></div>
            <div style="color: #888; font-size: 0.9rem; margin-top: -0.5rem; margin-bottom: 1rem;">
                Leave empty for scalar (empty string).
            </div>

            <label>Condition name</label>
            <input id="in_particleConditionName" type="text" placeholder="is_active">

            <label>Condition args (comma-separated)</label>
            <input id="in_particleConditionArgs" type="text" placeholder="1, 2">

            <label style="margin:1rem;" >Request body</label>
            <div class="request-row">
                <div class="response-wrapper">
                    <button id="btn_particleCopyRequest" class="copy-button">üìã</button>
                    <pre id="POST_particleRequestBody" class="request-body">...</pre>
                </div>
            </div>

            <button id="btn_sendStructuredParticle">üîí Send</button>

            <div class="response-row">
                <div id="POST_particleResponseCode" class="response-code">-</div>
                <div id="POST_particleResponseBody" class="response-body">Waiting...</div>
            </div>
        </div>
        <div class="column">
            <label>Address (optional)</label>
            <input id="GET_particleAddress" type="text" placeholder="0x0...">
            <button id="btn_getParticle">Fetch</button>
            <div class="response-row">
                <div id="GET_particleResponseCode" class="response-code">-</div>
                <div id="GET_particleResponseBody" class="response-body">Waiting...</div>
            </div>
        </div>
        </div>
    </div>
    </main>
</body>
</html>
